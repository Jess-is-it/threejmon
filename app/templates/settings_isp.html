{% extends "base.html" %}
{% block content %}
<div class="card">
  <h2>ISP Ping Settings</h2>
  {% if message %}
    <div class="alert">{{ message }}</div>
  {% endif %}
  <form method="post">
    <div class="toggle">
      <input type="checkbox" name="enabled" id="enabled" {% if settings.enabled %}checked{% endif %} />
      <label for="enabled">Enable ISP ping notifier</label>
    </div>
    <div class="help">Telegram settings are managed under ISP Pulsewatch.</div>

    <h3>Ping</h3>
    <div class="form-grid">
      <div>
        <label>Timeout (seconds) <span class="info" data-tip="Timeout per ping attempt.">i</span></label>
        <input type="number" name="ping_timeout_seconds" value="{{ settings.general.ping_timeout_seconds }}" />
      </div>
      <div>
        <label>Ping Count <span class="info" data-tip="How many ping attempts per target.">i</span></label>
        <input type="number" name="ping_count" value="{{ settings.general.ping_count }}" />
      </div>
      <div>
        <label>Max Parallel Pings <span class="info" data-tip="Number of targets checked in parallel.">i</span></label>
        <input type="number" name="max_parallel_pings" value="{{ settings.general.max_parallel_pings }}" />
      </div>
      <div>
        <label>Interval (seconds) <span class="info" data-tip="Delay between repeated checks in daemon mode.">i</span></label>
        <input type="number" name="daemon_interval_seconds" value="{{ settings.general.daemon_interval_seconds }}" />
      </div>
      <div>
        <label>Include ICMP ping when ISP is UP <span class="info" data-tip="Include ICMP reply lines when a link goes UP.">i</span></label>
        <input type="checkbox" name="include_up_icmp" id="include_up_icmp" {% if settings.general.include_up_icmp %}checked{% endif %} />
      </div>
      <div>
        <label>UP ICMP Lines <span class="info" data-tip="Number of ICMP lines to include (max 20). Higher values delay notifications.">i</span></label>
        <input type="number" name="up_icmp_lines" id="up_icmp_lines" min="1" max="20" value="{{ settings.general.up_icmp_lines }}" />
        <div class="help">Higher values take longer to send.</div>
      </div>
    </div>

    <h3>Daily Report</h3>
    <div class="form-grid">
      <div>
        <label>Daily Time (HH:MM) <span class="info" data-tip="Daily report time for ISP status summary.">i</span></label>
        <input type="text" name="daily_time" value="{{ settings.report.daily_time }}" />
      </div>
      <div>
        <label>Timezone <span class="info" data-tip="Timezone for the daily report schedule.">i</span></label>
        <input type="text" name="timezone" value="{{ settings.report.timezone }}" />
      </div>
    </div>

    <h3>Legacy Targets</h3>
    <label>Targets (ip | label | down_message | up_message) <span class="info" data-tip="One target per line. Only IP is required; label and messages are optional.">i</span></label>
    <textarea name="targets">{% for item in settings.targets %}{{ item.ip }} | {{ item.label }} | {{ item.down_message }} | {{ item.up_message }}
{% endfor %}</textarea>
    <div class="help">One target per line. Only IP is required; other fields are optional.</div>

    <div style="margin-top: 16px;">
      <button type="submit" class="button-green">Save ISP Ping Settings</button>
    </div>
  </form>
  <form method="post" action="/settings/isp/test" style="margin-top: 12px;">
    <button type="submit">Send Test Telegram</button>
  </form>
  <form method="post" action="/settings/isp/run" style="margin-top: 12px;">
    <button type="submit" class="button-blue">Send Actual Test</button>
  </form>
</div>
<script>
  const includeUpIcmp = document.getElementById("include_up_icmp");
  const upIcmpLines = document.getElementById("up_icmp_lines");
  const toggleUpIcmp = () => {
    const enabled = includeUpIcmp.checked;
    upIcmpLines.disabled = !enabled;
    upIcmpLines.style.opacity = enabled ? "1" : "0.6";
  };
  includeUpIcmp.addEventListener("change", toggleUpIcmp);
  toggleUpIcmp();
</script>
{% endblock %}
