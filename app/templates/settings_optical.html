{% extends "base.html" %}
{% block content %}
<div class="card">
  <h2>Optical Settings</h2>
  {% if message %}
    <div class="alert">{{ message }}</div>
  {% endif %}
  <form method="post">
    <div class="toggle">
      <input type="checkbox" name="enabled" id="enabled" {% if settings.enabled %}checked{% endif %} />
      <label for="enabled">Enable optical notifier</label>
    </div>

    <h3>GenieACS</h3>
    <div class="form-grid">
      <div>
        <label>Base URL <span class="info" data-tip="GenieACS server base address (example: http://genieacs:7557).">i</span></label>
        <input type="text" name="genieacs_base_url" value="{{ settings.genieacs.base_url }}" />
      </div>
      <div>
        <label>Username <span class="info" data-tip="GenieACS API username used for authentication.">i</span></label>
        <input type="text" name="genieacs_username" value="{{ settings.genieacs.username }}" />
      </div>
      <div>
        <label>Password <span class="info" data-tip="GenieACS API password used for authentication.">i</span></label>
        <input type="password" name="genieacs_password" value="{{ settings.genieacs.password }}" />
      </div>
      <div>
        <label>Page Size <span class="info" data-tip="How many devices per GenieACS page request.">i</span></label>
        <input type="number" name="genieacs_page_size" value="{{ settings.genieacs.page_size }}" />
      </div>
    </div>

    <h3>Telegram</h3>
    <div class="form-grid">
      <div>
        <label>Bot Token <span class="info" data-tip="Telegram bot token from BotFather.">i</span></label>
        <input type="text" name="telegram_bot_token" value="{{ settings.telegram.bot_token }}" />
      </div>
      <div>
        <label>Chat ID <span class="info" data-tip="Target Telegram chat ID where alerts should be sent.">i</span></label>
        <input type="text" name="telegram_chat_id" value="{{ settings.telegram.chat_id }}" />
      </div>
    </div>

    <h3>Thresholds</h3>
    <div class="form-grid">
      <div>
        <label>RX Threshold (dBm) <span class="info" data-tip="Alert if RX power is below this value.">i</span></label>
        <input type="number" step="0.1" name="rx_threshold_dbm" value="{{ settings.optical.rx_threshold_dbm }}" />
      </div>
      <div>
        <label>TX Low Threshold (dBm) <span class="info" data-tip="Alert if TX power is below this value.">i</span></label>
        <input type="number" step="0.1" name="tx_low_threshold_dbm" value="{{ settings.optical.tx_low_threshold_dbm }}" />
      </div>
      <div>
        <label>Priority RX Threshold (dBm) <span class="info" data-tip="RX power below this becomes priority in alerts.">i</span></label>
        <input type="number" step="0.1" name="priority_rx_threshold_dbm" value="{{ settings.optical.priority_rx_threshold_dbm }}" />
      </div>
    </div>

    <h3>Paths</h3>
    <div class="form-grid">
      <div>
        <label>RX Paths <span class="info" data-tip="GenieACS parameter paths for RX power. One per line.">i</span></label>
        <textarea name="rx_paths">{{ settings.optical.rx_paths | join('\n') }}</textarea>
      </div>
      <div>
        <label>TX Paths <span class="info" data-tip="GenieACS parameter paths for TX power. One per line.">i</span></label>
        <textarea name="tx_paths">{{ settings.optical.tx_paths | join('\n') }}</textarea>
      </div>
      <div>
        <label>PPPOE Paths <span class="info" data-tip="Paths used to locate the subscriber username.">i</span></label>
        <textarea name="pppoe_paths">{{ settings.optical.pppoe_paths | join('\n') }}</textarea>
      </div>
      <div>
        <label>IP Paths <span class="info" data-tip="Paths used to locate the subscriber IP address.">i</span></label>
        <textarea name="ip_paths">{{ settings.optical.ip_paths | join('\n') }}</textarea>
      </div>
    </div>

    <h3>Schedule</h3>
    <div class="form-grid">
      <div>
        <label>Message Title <span class="info" data-tip="Title shown at the top of each Telegram message.">i</span></label>
        <input type="text" name="message_title" value="{{ settings.general.message_title }}" />
      </div>
      <div>
        <label>Include Header <span class="info" data-tip="Adds a column header row to the message.">i</span></label>
        <input type="checkbox" name="include_header" {% if settings.general.include_header %}checked{% endif %} />
      </div>
      <div>
        <label>Max Characters <span class="info" data-tip="Split messages when they exceed this length.">i</span></label>
        <input type="number" name="max_chars" value="{{ settings.general.max_chars }}" />
      </div>
      <div>
        <label>Schedule Time (HH:MM) <span class="info" data-tip="Daily time to run the optical check.">i</span></label>
        <input type="text" name="schedule_time_ph" value="{{ settings.general.schedule_time_ph }}" />
      </div>
      <div>
        <label>Timezone <span class="info" data-tip="Timezone for the schedule (example: Asia/Manila).">i</span></label>
        <input type="text" name="timezone" value="{{ settings.general.timezone }}" />
      </div>
    </div>

    <div style="margin-top: 16px;">
      <button type="submit" class="button-green">Save Optical Settings</button>
    </div>
  </form>
  <form method="post" action="/settings/optical/test" style="margin-top: 12px;">
    <button type="submit">Send Test Telegram</button>
  </form>
  <form method="post" action="/settings/optical/run" style="margin-top: 12px;">
    <button type="submit" class="button-blue">Send Actual Test</button>
  </form>
</div>
{% endblock %}
