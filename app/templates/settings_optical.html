{% extends "base.html" %}
{% block content %}
<div class="page-header d-print-none">
  <div class="row align-items-center">
    <div class="col">
      <h2 class="page-title">Optical Settings</h2>
    </div>
  </div>
</div>

{% if message %}
  <div class="alert alert-info">{{ message }}</div>
{% endif %}

<div class="card">
  <div class="card-body">
    <form method="post">
      <div class="card mb-3">
        <div class="card-body">
          <h4 class="mb-3">General</h4>
          <label class="form-label">Enable optical notifier</label>
          <label class="form-check form-switch">
            <input class="form-check-input" type="checkbox" name="enabled" {% if settings.enabled %}checked{% endif %} />
            <span class="form-check-label">Active</span>
          </label>
        </div>
      </div>

      <div class="card mb-3">
        <div class="card-body">
          <h4 class="mb-3">GenieACS</h4>
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Base URL <span class="info" data-tip="GenieACS server base address (example: http://genieacs:7557).">i</span></label>
              <input class="form-control" type="text" name="genieacs_base_url" value="{{ settings.genieacs.base_url }}" />
            </div>
            <div class="col-md-6">
              <label class="form-label">Username <span class="info" data-tip="GenieACS API username used for authentication.">i</span></label>
              <input class="form-control" type="text" name="genieacs_username" value="{{ settings.genieacs.username }}" />
            </div>
            <div class="col-md-6">
              <label class="form-label">Password <span class="info" data-tip="GenieACS API password used for authentication.">i</span></label>
              <input class="form-control" type="password" name="genieacs_password" value="{{ settings.genieacs.password }}" />
            </div>
            <div class="col-md-6">
              <label class="form-label">Page Size <span class="info" data-tip="How many devices per GenieACS page request.">i</span></label>
              <input class="form-control" type="number" name="genieacs_page_size" value="{{ settings.genieacs.page_size }}" />
            </div>
          </div>
        </div>
      </div>

      <div class="card mb-3">
        <div class="card-body">
          <h4 class="mb-3">Telegram</h4>
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Bot Token <span class="info" data-tip="Telegram bot token from BotFather.">i</span></label>
              <input class="form-control" type="text" name="telegram_bot_token" value="{{ settings.telegram.bot_token }}" />
            </div>
            <div class="col-md-6">
              <label class="form-label">Chat ID <span class="info" data-tip="Target Telegram chat ID where alerts should be sent.">i</span></label>
              <input class="form-control" type="text" name="telegram_chat_id" value="{{ settings.telegram.chat_id }}" />
            </div>
          </div>
        </div>
      </div>

      <div class="card mb-3">
        <div class="card-body">
          <h4 class="mb-3">Thresholds</h4>
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">RX Threshold (dBm) <span class="info" data-tip="Alert if RX power is below this value.">i</span></label>
              <input class="form-control" type="number" step="0.1" name="rx_threshold_dbm" value="{{ settings.optical.rx_threshold_dbm }}" />
            </div>
            <div class="col-md-4">
              <label class="form-label">TX Low Threshold (dBm) <span class="info" data-tip="Alert if TX power is below this value.">i</span></label>
              <input class="form-control" type="number" step="0.1" name="tx_low_threshold_dbm" value="{{ settings.optical.tx_low_threshold_dbm }}" />
            </div>
            <div class="col-md-4">
              <label class="form-label">Priority RX Threshold (dBm) <span class="info" data-tip="RX power below this becomes priority in alerts.">i</span></label>
              <input class="form-control" type="number" step="0.1" name="priority_rx_threshold_dbm" value="{{ settings.optical.priority_rx_threshold_dbm }}" />
            </div>
          </div>
        </div>
      </div>

      <div class="card mb-3">
        <div class="card-body">
          <h4 class="mb-3">Paths</h4>
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">RX Paths <span class="info" data-tip="GenieACS parameter paths for RX power. One per line.">i</span></label>
              <textarea class="form-control" name="rx_paths" rows="5">{{ settings.optical.rx_paths | join('\n') }}</textarea>
            </div>
            <div class="col-md-6">
              <label class="form-label">TX Paths <span class="info" data-tip="GenieACS parameter paths for TX power. One per line.">i</span></label>
              <textarea class="form-control" name="tx_paths" rows="5">{{ settings.optical.tx_paths | join('\n') }}</textarea>
            </div>
            <div class="col-md-6">
              <label class="form-label">PPPOE Paths <span class="info" data-tip="Paths used to locate the subscriber username.">i</span></label>
              <textarea class="form-control" name="pppoe_paths" rows="5">{{ settings.optical.pppoe_paths | join('\n') }}</textarea>
            </div>
            <div class="col-md-6">
              <label class="form-label">IP Paths <span class="info" data-tip="Paths used to locate the subscriber IP address.">i</span></label>
              <textarea class="form-control" name="ip_paths" rows="5">{{ settings.optical.ip_paths | join('\n') }}</textarea>
            </div>
          </div>
        </div>
      </div>

      <div class="card mb-3">
        <div class="card-body">
          <h4 class="mb-3">Schedule</h4>
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">Message Title <span class="info" data-tip="Title shown at the top of each Telegram message.">i</span></label>
              <input class="form-control" type="text" name="message_title" value="{{ settings.general.message_title }}" />
            </div>
            <div class="col-md-4">
              <label class="form-label">Include Header <span class="info" data-tip="Adds a column header row to the message.">i</span></label>
              <label class="form-check form-switch">
                <input class="form-check-input" type="checkbox" name="include_header" {% if settings.general.include_header %}checked{% endif %} />
                <span class="form-check-label">Enabled</span>
              </label>
            </div>
            <div class="col-md-4">
              <label class="form-label">Max Characters <span class="info" data-tip="Split messages when they exceed this length.">i</span></label>
              <input class="form-control" type="number" name="max_chars" value="{{ settings.general.max_chars }}" />
            </div>
            <div class="col-md-4">
              <label class="form-label">Schedule Time (HH:MM) <span class="info" data-tip="Daily time to run the optical check.">i</span></label>
              <input class="form-control" type="text" name="schedule_time_ph" value="{{ settings.general.schedule_time_ph }}" />
            </div>
            <div class="col-md-4">
              <label class="form-label">Timezone <span class="info" data-tip="Timezone for the schedule (example: Asia/Manila).">i</span></label>
              <input class="form-control" type="text" name="timezone" value="{{ settings.general.timezone }}" />
            </div>
          </div>
        </div>
      </div>

      <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary">Save Optical Settings</button>
      </div>
    </form>
  </div>
  <div class="card-footer">
    <div class="d-flex flex-wrap gap-2">
      <form method="post" action="/settings/optical/test">
        <button type="submit" class="btn">Send Test Telegram</button>
      </form>
      <form method="post" action="/settings/optical/run">
        <button type="submit" class="btn btn-outline-primary">Send Actual Test</button>
      </form>
    </div>
  </div>
</div>
{% endblock %}
